<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Envío WhatsApp (360dialog) — CSV</title>
  <style>
    body{font-family:system-ui,Arial;margin:20px}
    .box{max-width:860px;border:1px solid #ddd;border-radius:12px;padding:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
    .field{display:flex;flex-direction:column;gap:6px}
    input{padding:8px;border:1px solid #ccc;border-radius:8px}
    button{padding:8px 12px;border-radius:10px;border:1px solid #bbb;cursor:pointer;background:#f6f6f6}
    button.primary{background:#111;color:#fff;border-color:#111}
    button.danger{background:#ffeded;border-color:#ffb3b3}
    .small{font-size:12px;color:#555}
    .stat{margin-top:10px;padding:10px;border:1px solid #eee;border-radius:10px;background:#fafafa}
    pre{background:#111;color:#eaeaea;padding:12px;border-radius:12px;overflow:auto;max-width:860px;white-space:pre-wrap}
    .warn{color:#b26a00;font-weight:700}
    .ok{color:#1a7f37;font-weight:700}
  </style>
</head>
<body>

<div class="box">
  <h2>Envío WhatsApp (360dialog) — CSV</h2>

  <div class="small">
    CSV esperado: <b>phone,name</b><br>
    Teléfono: <b>549 + número</b> (ej: <b>5491136065609</b>)<br>
    <span class="warn">Por CORS en GitHub Pages, no se puede leer la respuesta del Apps Script.</span><br>
    <span class="ok">La confirmación REAL está en tu Google Sheet → pestaña <b>LOG</b>.</span>
  </div>

  <div class="row" style="margin-top:12px">
    <div class="field">
      <label>Template</label>
      <input id="template" value="promo_optica_cristal_01" />
    </div>

    <div class="field">
      <label>Idioma</label>
      <input id="lang" value="es_AR" />
    </div>

    <div class="field">
      <label>Tamaño lote</label>
      <input id="lot" value="50" style="width:90px" />
    </div>

    <div class="field">
      <label>Pausa (ms)</label>
      <input id="pause" value="900" style="width:90px" />
    </div>
  </div>

  <div class="row" style="margin-top:12px">
    <div class="field">
      <label>CSV</label>
      <input type="file" id="file" accept=".csv" />
    </div>

    <button id="btnLoad">Cargar CSV</button>
    <button class="primary" id="btnSend">Enviar</button>
    <button id="btnPing">Probar ping</button>
    <button class="danger" id="btnClear">Limpiar</button>
  </div>

  <div class="stat">
    Contactos leídos: <b id="cRead">0</b> |
    Válidos: <b id="cOk">0</b> |
    Estado: <b id="status">—</b>
    <div class="small" style="margin-top:6px">
      Tip: probá primero con tu CSV de <b>2 números</b>. Si falla, mirá el error real en <b>LOG</b>.
    </div>
  </div>
</div>

<h3>Log</h3>
<pre id="log"></pre>

<!-- Iframe oculto: hace que el POST funcione sin CORS -->
<iframe name="wa_sink" style="display:none"></iframe>

<script src="app.js"></script>
</body>
</html>
